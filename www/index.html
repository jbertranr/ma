<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
   <head>
        <title>Mobilitat - Avisos</title>
        <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"> 
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />        
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/MarkerCluster.Default.css">  
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">   
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
        
        <style> 
                        
            //.leaflet-control-locate {display:none}
            
            .ui-listview > .ui-li-static {
                font-size: 0.8em;
                padding: 0.4em 0.5em;
            }
            
            .ui-li {
              height: auto;
            }
            .bloquejat--ui-panel-dismiss-open.ui-panel-dismiss-position-left{
               left:25em
             }
            
            .ui-input-search{margin-top:0em;margin-bottom:0.2em;}
            
            .ui-content {padding:0em;}
            
            #autocomplete {margin:0em}
            
            #portada{
                width:100%;
                height:100%;
                margin:0px;
                background-color:#f0cd2a;
            }
            
			   #fotoPortada{
                width:100%;
                height:100%;
                margin:0px;              
            }              
            
            @font-face {
                font-family: "novaFont";
                src: url("./fonts/Lato-Regular.ttf");
            }
            
            #map { 
                margin:-15px;
                height: 100%;
                width:100%; 
            }
            
            #mapDetail { 
                margin:-15px;
                height: 100%;
                width:100%; 
            }
            
            #POIDetail {
                height: 10%;
                width:100%; 
            }
            
		    .boto_4 {
				text-align: center;
				width: 20%;
				margin: 1% 2%;
				border-radius: 5px;
				background-color: #777;
				padding-top: 0.6em;
				float: left;
				height: 2em;
				width: 20%;
				text-shadow:none;
				color:#fff;
			}

			.boto_4:hover {
				background-color: #2075c8;
				color:#444;
			}
			
        .cub{
           font-weight:bold;
           text-shadow:none;
           background-color: transparent;
           text-align:center; 
           height:35px;
           margin-top: 0em; 
           margin-left:0em;
           float: left; 
           color: rgb(244, 244, 244); 
           font-family:novaFont;
           width: 80px;                    
        }
            
            
         .controlMapa-junt {
             margin-top: 1px;
        }

			.controlMapa {
				background-color: #359;
				border-radius: 5px;
				color: #ffffff;
				cursor: pointer;
				font-family: verdana;
				font-size: 27px;
				font-weight: bold;
				height: 40px;
				opacity: 0.93;
				text-align: center;
				width: 41px;
				z-index: 999999;
				padding-left: -1px;
				padding-top: 0px;
				text-shadow: 0px 0px #000000;
            overflow:hidden;
			}
			
            .controlMapa:hover {opacity:0.97}

            .controlMapa-separat {margin-top:5px}
            
            .caixaControl{ z-index:5000;position:fixed;left:23px;bottom:53px; }

            .caixaControlInferior {
                position: fixed;
                right: 0;
                top: 201px;
                z-index: 5000;
            }
			.caixaControlPeu{ z-index:5000;position:fixed;right:20px;bottom:60px; }
			
            .cubTitol { font-size: 0.8em;  height: 6px; width:100%;margin-top:5px;font-family:novaFont;  }
            .cubValor { margin-top:0.2em;font-size: 1.8em;  height: 26px; ; color: #ffffff;width:100%;font-family:novaFont; }
            .cubUnitat { margin-bottom:7px;font-size:0.8em;margin-top:0em;height:15px;font-family:novaFont; }
            
            .cubPetit{
                font-weight:bold;
                text-shadow:none;
                background-color: #ffffff;
                text-align:center; 
                height:37px;                
                float: left; 
                color: rgb(244, 244, 244); 
                font-family:novaFont; 
                width: 80px;
                margin:0;
            }
            
            .cubGran{
                font-weight:bold;
                text-shadow:none;
                background-color: #ffffff;
                text-align:center; 
                height:74px;                
                float: left; 
                color: rgb(244, 244, 244); 
                font-family:Helvetica;
                width: 80px;
                margin:0;
                font-family: novaFont;
            }
            .cubPetitTitol { font-size: 0.6em;  height: 6px; width:100%;margin-top:0px;font-family:novaFont  }
            .cubPetitValor {margin-top:0 em;font-size: 1.2em;  height: 18px; ; color: #ffffff;width:100%;font-family:novaFont }
            .cubPetitUnitat {margin-bottom:7px;font-size:0.6em;margin-top:0em;height:10px;font-family:novaFont }
            .cubsContenidor { width:100%;height:125px;clear:both;border-bottom: 1px dotted #dddddd;overflow:hidden; padding-bottom:4px;}
            .iconWrapper { float:right;margin-right:30px;margin-top:15px}
            .botoDescripcioActiu {margin-top: 0.6em; font-size: 1em; overflow: hidden; height: auto; width: 200px; text-align: center; color: rgb(255, 255, 255); background-color: rgb(130, 2, 10)}            
        </style>
    
		  <script src="phonegap.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.js"></script> 
        <script src="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/leaflet.markercluster.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.5/leaflet.markercluster-src.js "></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.3/proj4.js"></script>  
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.1/proj4leaflet.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>  
        <script src="https://mapes.mataro.cat/OpenData/CSS/pluginmapa.js"></script>          
        <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
        <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
        <!--script type="text/javascript"> 
         
         (function (window, document, undefined) {
          L.Control.Custom = L.Control.extend({
              version: '1.0.1',
              options: {
                  position: 'topright',
                  id: '',
                  title: '',
                  classes: '',
                  content: '',
                  style: {},
                  datas: {},
                  events: {},
              },
              container: null,
              onAdd: function (map) {
                  this.container = L.DomUtil.create('div');
                  this.container.id = this.options.id;
                  this.container.title = this.options.title;
                  this.container.className = this.options.classes;
                  this.container.innerHTML = this.options.content;

                  for (var option in this.options.style)
                  {
                      this.container.style[option] = this.options.style[option];
                  }

                  for (var data in this.options.datas)
                  {
                      this.container.dataset[data] = this.options.datas[data];
                  }


                  /* Prevent click events propagation to map */
                  L.DomEvent.disableClickPropagation(this.container);

                  /* Prevent right click event propagation to map */
                  L.DomEvent.on(this.container, 'contextmenu', function (ev)
                  {
                      L.DomEvent.stopPropagation(ev);
                  });

                  /* Prevent scroll events propagation to map when cursor on the div */
                  L.DomEvent.disableScrollPropagation(this.container);

                  for (var event in this.options.events)
                  {
                      L.DomEvent.on(this.container, event, this.options.events[event], this.container);
                  }

                  return this.container;
              },

              onRemove: function (map) {
                  for (var event in this.options.events)
                  {
                      L.DomEvent.off(this.container, event, this.options.events[event], this.container);
                  }
              },
          });

          L.control.custom = function (options) {
              return new L.Control.Custom(options);
          };

      }(window, document));
      </script-->
        <script type="text/javascript"> 

            // -- 1 INCIALITZACIÓ DE L'OBJECTE GENERAL DEL MAPA        
        
            var visor = {
                'resposta' : [{"codi":"1286","usuari_codi":"0","adreca":"Casa dels francesos, Carrer Trafalgar, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:32:33","descripcio":"Rfffffdddfddd","imatge":"1492378360228.jpg","den_x":"2.3882335424423218","den_y":"41.504160132476564","usu_x":"2.3882335424423218","usu_y":"41.504160132476564"},{"codi":"1287","usuari_codi":"0","adreca":"Casa dels francesos, Carrer Trafalgar, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:36:09","descripcio":"Rfffff","imatge":"1492378575221.jpg","den_x":"2.388042944676272","den_y":"41.503662199338535","usu_x":"2.388042944676272","usu_y":"41.503662199338535"},{"codi":"1288","usuari_codi":"0","adreca":"Carrer de Santa Maria, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:37:13","descripcio":"Rfffff","imatge":"1492378639662.jpg","den_x":"2.3876781642502465","den_y":"41.50325643214635","usu_x":"2.3876781642502465","usu_y":"41.50325643214635"},{"codi":"1289","usuari_codi":"0","adreca":"Pla\u00e7a Jeroni Gelpi, Avinguda de l'Escultor Monjo, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:38:06","descripcio":"Tfffff dhdhdhrhehe sgsgsgsg sgsgsgsg sgsgsgsg dndh","imatge":"1492378691955.jpg","den_x":"2.3885138922196347","den_y":"41.50461938206671","usu_x":"2.3885138922196347","usu_y":"41.50461938206671"},{"codi":"1290","usuari_codi":"0","adreca":"Casa dels francesos, Carrer Trafalgar, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:54:33","descripcio":"Tfffff","imatge":"1492379680079.jpg","den_x":"2.388378381729126","den_y":"41.503432969315305","usu_x":"2.388378381729126","usu_y":"41.503432969315305"},{"codi":"1291","usuari_codi":"0","adreca":"Queviures, Carrer de Sant Gen\u00eds, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 21:55:37","descripcio":"Fffggg","imatge":"1492379743645.jpg","den_x":"2.38828182220459","den_y":"41.503035235733684","usu_x":"2.38828182220459","usu_y":"41.503035235733684"},{"codi":"1292","usuari_codi":"0","adreca":"Casa dels francesos, Carrer Trafalgar, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 22:03:56","descripcio":"Tfffff","imatge":"1492380243629.jpg","den_x":"2.3886841535568237","den_y":"41.50376642083944","usu_x":"2.3886841535568237","usu_y":"41.50376642083944"},{"codi":"1293","usuari_codi":"0","adreca":"Motocicletes Rocamoto, Carrer de Santa Maria, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 22:10:09","descripcio":"Tfffff","imatge":"1492380614447.jpg","den_x":"2.388753890991211","den_y":"41.50339279431696","usu_x":"2.388753890991211","usu_y":"41.50339279431696"},{"codi":"1294","usuari_codi":"0","adreca":"Motocicletes Rocamoto, Carrer de Santa Maria, Vilasar de Mar, Maresme, Barcelona, Catalu\u00f1a, 08340, Espa\u00f1a","data_imatge":"2017-04-16 22:10:42","descripcio":"Tfffff","imatge":"1492380648569.jpg","den_x":"2.3888933658599854","den_y":"41.50305130582475","usu_x":"2.3888933658599854","usu_y":"41.50305130582475"},{"codi":"1295","usuari_codi":"0","adreca":"Tip-Top, Rac\u00f3 del Trist, Montju\u00efc, Sants-Montju\u00efc, Barcelona, Barcelon\u00e8s, Barcelona, Catalunya, 08038, Espanya","data_imatge":"2017-04-16 22:18:50","descripcio":"Vyfyfyfyf5f5","imatge":"1492381139331.jpg","den_x":"2.1476026077289134","den_y":"41.36932337563419","usu_x":"2.1476026077289134","usu_y":"41.36932337563419"}], 
				    'actiu' : 0,
                'markerGroupPosActual': null,
                'markerGroupPosActualDetail': null,
                'markerGroup': null,
                'markerGroupDetail': null,
                'llistaInicial': 0,
                //'map' : {}, //  Objecte Leaflet del mapa per evitar problemes d'inicialització
                'mapDetail' : {}, //    Objecte Leaflet del mapa Detall
                'wpid' : 0,
                'modeNavegacio' : null,
                'modePunt' : null,
                'nouPuntEdicio': null,
                'popup' : null,
                'greenIcon' : {},
                'valoracio' : null,
                'icon' : null,
                'markerPosicioActual' : {},
                'markerPosicioActualPresent' : '0',
                'config' : { 'layers' : { 'base' : [], 'overlay' : [] }},
                'posicioActual' : { 'trobat': 0, 'lat' : 0, 'lng' : 0, 'alt' : 0, 'acc' : 0 },
                'posicioAnterior' : { 'trobat': 0, 'lat' : 0,   'lng' : 0, 'alt' : 0, 'acc' : 0 },
                'POI' : [{  'nom' : null , 'descripcio': null , 'lat': null , 'lng':null, 'tema' : null, 'icona' : null , 'seleccionat' : 0, 'distancia' : null}],
                'filtre' : {  'seleccionat' : 0 , 'valoracioMin':0, 'valoracioMax': 100, 'categoria': 'platja.png', 'distancia': 40000 },
                'cerclePrecisio':null,
                'capaPosicio':null,
                'posicioActual':0,
                'watchID':{},
                'locate':{},
                'totMarker': new L.FeatureGroup(),
                'posicioCamera':{},
                'markerCamera':{},
                'data':{},
                'adrecaOSM':null,
				    'params': {  projecte: 'Mobilitat', 'codi' : null , 'usuari_codi':null, 'adreca': null, 'descripcio': null, 'imatge': null , 'den_x' : null , 'den_y':null, 'usu_x': null, 'usu_y': null, 'correu': null , 'risc': null},
                'primeraUbicació' :  1,
				    'codiAvisVigent' : null,
				    'darrerAvislista' : null,
                'tema':'equipament',
                'cercaActiva': ['acces', 'carrer', 'equipament', 'terrassa','entitat'],
                'cercaHTML':'',
                'ordena':null,
                'temaActiu':''
            };
 
 
            // -- 2 INICIALITZACIÓ DE LES PANTALLES - Eevents    
            //-- Totes les pantalles            
            $( window ).on( 'orientationchange', function( event ) {ajustaPortada();});  
            //document.addEventListener('touchmove', function(e) { e.preventDefault(); }, false);            
            
            $( document ).on('beforepageshow' ,'#portada', function(){ 
                $(window).bind('resize', function (){   ajustaFinestres();
                                                        ajustaPortada();  
                                                     });
                $.mobile.page.prototype.options.theme = "a";                    
                $('#pageMap').trigger('pagecreate');
                if (visor.actiu == 0){
                    //setTimeout(function(){inicialitzaMapa(),3000}); 
                    inicialitzaMapa();
					    visor.actiu = 1;    
                }    
            });
             
            //-- Inicia pageMap                    
            $( document ).on('pageshow','#pageMap', function(){
                inicialitzaMapa(); 
                setTimeout(function(){ajustaFinestres(),3000});  
            });
            
            $(window).bind('resize', function () {ajustaFinestres();});
            
            
            $( document ).on( "pagecreate", "#pageMap", function() {  
                 $('#autocomplete-input').on ('focusin', function(){ setTimeout(function(){ajustaFinestres();},3000)});
                   
                 $( "#autocomplete-input" ).on( "input", function (  ) {
                    //alert('KEYPRESSED');                    
                    var $ul = $("#autocomplete");
                    $ul.html( "" );
                    visor.cercaHTML = '';
                    $ul.listview( "refresh" );
                    var value =  $('#autocomplete-input').val(); 
                    //var numResposta = 0; 
                    if ( value.length > 2 ) {
                       incorporaTemes(value, $ul);
                       ajustaFinestres(); 
                   }
                 }); 

                 $( "#taulaBase-input" ).on( "input", function (  ) {
                    //alert('KEYPRESSED');  
                    
                    //$("#taulaBase").listview( "refresh" );
                    //$("#taulaBase").trigger( "updatelayout" ); 
                    visor.cercaHTML = '';
                    var value =  $('#taulaBase-input').val(); 
                    //var numResposta = 0; 
                    //if ( value.length > 2 ) {
                    activaTema($("#taulaBase"), visor.temaActiu, value, 500)   
                    /*   cercaJSON(  'data/DS_TERRASSA01.json',
                                                $("#taulaBase"),
                                                'terrassa',
                                                'fa fa-coffee',
                                                value, 
                                                'ACCES_NOM', 
                                                'ACCES_NOM' , 
                                                'ACCES_NOM', 
                                                'WKT',
                                                 500);*/
                       ajustaFinestres(); 
                  // }
                 });                 
          
             });   

            function afegeixBotons(){
               L.easyButton('fa-coffee', function(btn, map){
                   $('#taulaBase-input').val('');
                   $('#panellMenu').panel('close');
                   $('#panellTaula').panel('open');
                   visor.cercaHTML= '' ;
                   visor.temaActiu = 'terrassa';
                   activaTema($("#taulaBase"), 'terrassa', '', 500);
                 }).addTo(visor.map);

               L.easyButton('fa-home', function(btn, map){
                   $('#taulaBase-input').val('');
                   $('#panellMenu').panel('close');
                   $('#panellTaula').panel('open');
                   visor.cercaHTML= '' ;
                   visor.temaActiu = 'equipament';
                   activaTema($("#taulaBase"), 'equipament', '', 500);
                 }).addTo(visor.map);
                 
                L.easyButton('fa-road', function(btn, map){
                   $('#taulaBase-input').val('');
                   $('#panellMenu').panel('close');
                   $('#panellTaula').panel('open');
                   visor.cercaHTML= '' ;
                   visor.temaActiu = 'carrer';
                   activaTema($("#taulaBase"), 'carrer', '', 500);
                 }).addTo(visor.map);   



                 
            }
            
        /*    function activaTaula( JSON, listview, temaCerca, faIcon, strCerca, colCerca, colEtiq1, colEtiq2, colWKT){
                cercaJSON(  JSON,
                            listview,
                            temaCerca,
                            faIcon,
                            '', 
                            'RAO_SOCIAL', 
                            'RAO_SOCIAL', 
                            'ADRECA', 
                            'WKT' );
             }      
      */
 
            function incorporaTemes(value,listview){
               $("#autocomplete").html('');
               var html = '';
               var test = '';
               visor.cercaHTML = '';
               
               $.each(visor.cercaActiva, function(i,temaCerca) {  //Temes sobre els que es fa la cerca 
                  activaTema(listview, visor.cercaActiva[i], value, 20);
               });
               
            }
 
 
            function activaTema(listview, nomTema, value, elements){               
                visor.cercaHTML = '';          
               switch(nomTema){ 
               
                  case 'acces': 
                                  
                                  cercaJSON(  'data/DS_ACCES01.json',
                                              listview,                               
                                              nomTema,
                                              'fas fa-envelope',
                                              value, 
                                              'ACCES_NOM', 
                                              'ACCES_NOM', 
                                              'NOM_CURT', 
                                              'WKT',
                                               elements);
                                            
                                   break;           
   



                 case 'entitat': 
                                  
                                  cercaJSON(  'data/DS_ENTITAT01.json',
                                              listview,
                                              nomTema,
                                              'fas fa-user-friends',
                                              value, 
                                              'RAO_SOCIAL', 
                                              'RAO_SOCIAL', 
                                              'ADRECA', 
                                              'WKT',
                                               elements);
                                            
                                   break;           
                                              
                  case 'carrer': cercaJSON(  'data/DS_CARRER01.json',
                                              listview,
                                              nomTema,
                                              'fas fa-road',
                                              value, 
                                              'NOM_CURT', 
                                              'NOM_LLARG', 
                                              'NOM_CURT', 
                                              'WKT',
                                               elements);
                                   break;
                                   
                  case 'equipament': cercaJSON( 'data/DS_EQUIP01.json',
                                                listview,
                                                nomTema,
                                                'fa fa-home',
                                                value, 
                                                'NOM', 
                                                'NOM', 
                                                'ADRECA', 
                                                'WKT',
                                                elements);
                                   break;
                                  
                   case 'terrassa': cercaJSON(  'data/DS_TERRASSA01.json',
                                                listview,
                                                nomTema,
                                                'fa fa-coffee',
                                                value, 
                                                'ACCES_NOM', 
                                                'ACCES_NOM' , 
                                                'ACCES_NOM', 
                                                'WKT',
                                                elements);
                                    break;           
                   }                  
                           
            }
 
 
            function cercaJSON( JSON, listview, temaCerca, faIcon, strCerca, colCerca, colEtiq1, colEtiq2, colWKT, nombre){
                var accesJSON;
                //var listview = $("#autocomplete");
                //visor.locate.start(); 
                
                $.getJSON( JSON, 
                           function ( response ) { 
                              accesJSON = response;   
                              var numResposta = 0;
                              var html = '';
                           //   $.each(visor.cercaActiva,function(i0, temaCerca) {  //Temes sobre els que es fa la cerca
                                 $.each(accesJSON.equipaments, function(i, equip) { // sobre equipament
                                    var cerca = strCerca.toUpperCase().split(' ').filter(Boolean);  // paraules de cerca treient els blanks
                                    var cert = 0;  // coincidències 
                                    $.each(cerca, function(i2,equip2){  // sobre paraula de cerca
                                       if ( equip[colCerca].toUpperCase().includes(cerca[i2].trim()) ) {
                                          cert += 1;                     
                                       }
                                    });    
                                    if ( cert == cerca.length ) { // si compleix amb totes les paraules de cerca
                                        if (numResposta == 0){
                                            html += " <li data-tema='" + temaCerca + "' data-dist='0'>" 
                                                   +  "   <div style='width:100%;height:auto;overflow:hidden;text-align:center;background-color:#eee'>"
                                                   +     temaCerca                                            
                                                   +  "    </div>"                                                  
                                                   +  " </li>";   
                                        } 
                                        numResposta += 1;
                                        if ( equip.hasOwnProperty('WKT') && visor.posicioActual.lat > 1 ) // Existeix l'atribut WKT i disposem de la posició
                                        {
                                           
                                           var dist = omnivore.wkt.parse(equip.WKT).getBounds().getCenter().distanceTo(  L.latLng(visor.posicioActual.lat, visor.posicioActual.lng));                                           
                                          // var dist = distance( punt.y, punt.x, visor.posicioActual.lat, visor.posicioActual.lng);                                           
                                          // visor.posicioActual.lat
                                          // alert(punt);
                                          /* 
                                           html += " <li>" 
                                                +  "   <div style='display:flex;flex-direction:row'> "
                                                +  "      <div style='max-width:4em;order:1;font-size:1em;margin-left:0em;width:4em;text-align:center'>" 
                                                +             Math.round(dist) + "m"
                                                +  "      </div>"
                                                +  "      <div style='flex:2;margin-top:0.2em;height:100%;max-width:6em;;font-size:0.8em;background-color:#ddd;color:#44;margin-right:1em;text-align:center;'>"
                                                +               temaCerca 
                                                +  "      </div>"                                              
                                                +  "      <div style='flex:3;float:left;margin-left:0.5em;min-width:10em' onclick=\"mostraPoligon('" + equip[colWKT] + "' );\" > "
                                                +            equip[colEtiq1]
                                                +  "         <span style='font-size:0.8em'>" + equip[colEtiq2] + "</span>"
                                                +  "       </div>" 
                                                +  "    </div>"                                                  
                                                +  " </li>";                                           
                                            */
                                           
                                           html += " <li data-tema='" + temaCerca + "' data-dist='" + Math.round(dist) + "'>" 
                                                +  "   <div style='width:100%;height:auto;overflow:hidden' '> "
                                                +  "      <div style='float:left;width:2.5em;height:auto;text-align:center;overflow:hidden;color:rgb(51, 85, 153)'> "
                                                +  "         <div style='height:auto;font-size:1.5em;'>" 
                                                +  "             <i class='" + faIcon + "'></i>"
                                                +  "         </div>"
                                                +  "         <div style='font-size: 0.8em;margin-top: -0.3em;'>"
                                                +                Math.round(dist) + "m" 
                                                +  "         </div>"                                              
                                                +  "      </div>"
                                                +  "      <div style='float:left;width:13em;height:auto;overflow:hidden;margin-left:0.5em;margin-top:0.2em;' onclick=\"mostraPoligon('" + equip[colWKT] + "' );\" > "
                                                +  "         <div style='width:auto;height:auto;white-space:normal;font-size:0.9em;' > "
                                                +               equip[colEtiq1]
                                                +  "         </div>" 
                                                +  "         <div style='font-size:0.85em;height:auto;margin-top:0.3em;width:auto;opacity:0.6;'> "
                                                +  "             <i>" + equip[colEtiq2] + "</i>";
                                                +  "         </div>"                                                
                                                +  "       </div>" 
                                                +  "    </div>"                                                  
                                                +  " </li>";   
                                        }
                                        
                                        else {                                        
                                          html += " <li data-tema='" + temaCerca + "' data-dist='2'>" 
                                                +  "   <div style='width:100%;height:auto;overflow:hidden' '> "
                                                +  "      <div style='float:left;width:2.5em;height:auto;text-align:center;overflow:hidden;color:rgb(51, 85, 153)'> "
                                                +  "         <div style='height:auto;font-size:1.5em;'>" 
                                                +  "             <i class='" + faIcon + "'></i>"
                                                +  "         </div>"
                                                +  "         <div style='font-size: 0.8em;margin-top: -0.3em;'>"
                                                +  "            ---- "  
                                                +  "         </div>"                                              
                                                +  "      </div>"
                                                +  "      <div style='float:left;width:13em;height:auto;overflow:hidden;margin-left:0.5em;margin-top:0.2em;' onclick=\"mostraPoligon('" + equip[colWKT] + "' );\" > "
                                                +  "         <div style='width:auto;height:auto;white-space:normal;font-size:0.9em;' > "
                                                +               equip[colEtiq1]
                                                +  "         </div>" 
                                                +  "         <div style='font-size:0.85em;height:auto;margin-top:0.3em;width:auto;opacity:0.6;'> "
                                                +  "             <i>" + equip[colEtiq2] + "</i>";
                                                +  "         </div>"                                                
                                                +  "       </div>" 
                                                +  "    </div>"                                                  
                                                +  " </li>";   
                                              
                                       }        
                                    } 
                                    
                                    if ( numResposta > nombre ){
                                              html += " <li data-dist='1' data-tema='" + temaCerca + "'>" 
                                                   +  "   <div style='width:100%;height:auto;overflow:hidden;text-align:center;background-color:#cdf'>"
                                                   +  "  Resultats parcials"                                     
                                                   +  "    </div>"                                                  
                                                   +  " </li>";   
                                                                        
                                       return false;
                                    }                   
                                  });

                              if ( visor.posicioActual.lat > 1 ) // Existeix l'atribut WKT i disposem de la posició
                              {                                          
                                 var ordena =  $('<div/>', {  id: 'ordena_id' }) .append(html);
                                 $(ordena).find("[data-tema='"+ temaCerca  +"']").sort(sort_li).appendTo($(ordena));
                                 visor.cercaHTML += $(ordena).html();
                              }
                              else {
                                 visor.cercaHTML += html;                               
                              } 
                            
                              listview.html( visor.cercaHTML );
                              listview.listview( "refresh" );
                              listview.trigger( "updatelayout" );   
                              
                 
                 }); 
                 
                 // sort function callback
                  function sort_li(a, b){
                      return (     $(b).data('dist')) < ($(a).data('dist')) ? 1 : -1;    
                   //   return (+$(a).data('dist') - +$(b).data('dist');
                  }
                              
            }
          
   
            //-- Inicia llistaElements          
            //$( document ).on('pagebeforeshow','#llistaElements', function(){
                //ajustaFinestres();
                //creaRelacioPunts(); Bloquejat l'accés al detall
            //});

            //-- Reajustaments dinàmics
 
            function ajustaFinestres(){         
                var resizeTimer = null;         
                if (resizeTimer) clearTimeout(resizeTimer);         
                //if($("#peuMapa").is(':visible')) { var alcPeuMapa =  $('#peuMapa').height() } else {var alcPeuMapa = 0}
                resizeTimer = setTimeout(function () {
                    $('#map').width($(window).width());
                    $('#map').height($(window).height() ); //abans -3
                    $('#autocomp').height($(window).height()  - 120 ); 
                    $('#taulaBaseWrap').height($(window).height()  - 120 );                     
                    $('#pageListContent').height($(window).height() - $('#pageListHeader').height() - $('#pageListFooter').height() - 89);
                    visor.map._onResize(); 
                });
            }
            
            //-- Ajusta la imatge de Portada al tamany dels dispositiu - Pendent no distorsionar la imatge
            function ajustaPortada(){           
                /*
                var resizeTimer = null;         
                if (resizeTimer) clearTimeout(resizeTimer);         
                resizeTimer = setTimeout(function () {
                    $('#fotoPortada').height($(window).height());               
                });
                */
            }

            // -- 3 FUNCIONS DEL VISOR LEAFLET
            //
            /*
            function mostraJSON(){ 
               fitxer = window.location.href.replace('index.html','') + 'data/DS_EQUIP01.json' ;
               var path = window.location.href.replace('index.html','');
               $.getJSON( path + "data/DS_EQUIP01.json", function( data ) {
                 var items = [];
                 $.each( data, function( key, val ) {
                   items.push( "<li id='" + key + "'>" + val + "</li>" );
                   alert(key + ' ' + val);
                 });
                
                 $( "<ul/>", {
                   "class": "my-new-list",
                   html: items.join( "" )
                 }).appendTo( "body" );
               });
            }
            */
            
            function mostraPoligon(WKT){
               if (num_marker > 0 ){
                    marker.remove();
               }  
               marker = omnivore.wkt.parse(WKT);
               marker.addTo(visor.map);
               visor.map.flyToBounds(marker.getBounds(),{ maxZoom: 5});
            }
            
            
            function distance(lat1, lon1, lat2, lon2, unit) {
               if ((lat1 == lat2) && (lon1 == lon2)) {
                  return 0;
               }
               else {
                  var radlat1 = Math.PI * lat1/180;
                  var radlat2 = Math.PI * lat2/180;
                  var theta = lon1-lon2;
                  var radtheta = Math.PI * theta/180;
                  var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                  if (dist > 1) {
                     dist = 1;
                  }
                  dist = Math.acos(dist);
                  dist = dist * 180/Math.PI;
                  dist = dist * 60 * 1.1515;
                  if (unit=="K") { dist = dist * 1.609344 }
                  if (unit=="N") { dist = dist * 0.8684 }
                  return dist;
               }
            }
 
  
            function cercaGenerica( fitxer ){
               fitxer = window.location.href.replace('index.html','') + 'data/DS_EQUIP01.json' ;
               $('#equipament').autocomplete({
                   source: function (request, response) {
                       $.getJSON( fitxer, function (data) {
                           response($.map(data.equipaments, function (value, key) {
                               return {
                                   label: value,
                                   value: key
                               };
                           }));
                       });
                   },
                   minLength: 2,
                   delay: 100
               });
            
            }
 
 
            
            // -- 4 INICIALITZACIÓ DEL MAPA LEAFLET 
            
			   // --   Inicialització del mapa 
            function inicialitzaMapa(){ 
            
               if ( visor.map == undefined) {
            
                  var crs25831 = new L.Proj.CRS('EPSG:25831','+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',   
                   {           
                       // resolutions:  [8.821702, 3.52868, 1.76394, 0.8820702, 0.352868, 0.176434, 0.0705736],   
                        bounds: L.bounds([257909.15, 4484800.15], [535906.39, 4751797.52]),
                        resolutions: [10, 5, 2, 1, 0.5,0.25, 0.15, 0.05],    
                       // bounds: L.bounds([258000,  4485000], [536000, 4752000]),    
                        origin: [257909.15, 4484800.15 ]      
                   }) 
     
                  var crs23031 =new L.Proj.CRS('EPSG:23031','+proj=utm +zone=31 +ellps=intl +units=m +no_defs',   
                   {           
                        resolutions: [10, 5, 2, 1, 0.5,0.25, 0.15, 0.05],    
                        bounds: L.bounds([258000,  4485000], [536000, 4752000]),  
                        origin: [258000,  4485000 ]      
                   }) 

                  var guiaUrbana = L.tileLayer(" http://serveisweb.mataro.cat/mapproxy/tms/1.0.0/ly_guiaurbana_tms/grd_25831_tms/{z}/{x}/{-y}.png", { 
                      maxZoom:7,  
                      minZoom:0,    
                      attribution: " Mataró "  
                    });
                    
                  var guiaUrbana_nit = L.tileLayer(" http:/serveisweb.mataro.cat/mapproxy/tms/1.0.0/ly_guiaurbana_nit_tms/grd_25831_tms/{z}/{x}/{-y}.png", {
                      maxZoom:7,  
                      minZoom:0,    
                      attribution: " Mataró "  
                    });

                   var serveiTopoCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", { 
                          layers: 'topo', 
                          format: 'image/jpeg', 
                          crs: crs25831, 
                          continuousWorld: true, 
                          attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC' 
                    });

                   var serveiOrtoCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", { 
                          layers: 'orto', 
                          format: 'image/jpeg', 
                          crs: crs25831, 
                          continuousWorld: true, 
                          attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC' 
                    });

                    var serveitopoGrisCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", {  
                          layers: 'topogris', 
                          format: 'image/jpeg', 
                          crs: crs25831, 
                          continuousWorld: true, 
                          attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC' 
                    });

                    var wmsComarques = L.tileLayer.wms("http://geoserveis.icc.cat/icc_limadmin/wms/service?", { 
                          layers: '5,1', 
                          format: 'image/png', 
                          crs: crs25831, 
                          transparent: true, 
                          continuousWorld: true, 
                          attribution: 'Base Comarcal 1:50.000 -ICGC' 
                    });        


                   var baseMaps = { 
                     'Guia Urbana' : guiaUrbana,
                     'Guia Urbana Nit' : guiaUrbana_nit,
                     'Topogràfic': serveiTopoCache,
                     'Topogràfic gris': serveitopoGrisCache,
                     'Ortofoto': serveiOrtoCache
                     }; 
                    
                    visor.map = L.map('contMapa',{ 
                                           crs: crs25831,
                                           worldCopyJump: false, 
                                           layers: [ baseMaps['Guia Urbana']],                             
                                            maxZoom:6,
                                            minZoom:0 })
                                            .setView([41.54, 2.44], 3);
                                            L.control.layers(baseMaps).addTo(visor.map);
                    
                    visor.map.doubleClickZoom.disable();
                   
 	

                  //visor.map = L.map('map', { zoomControl:false, detectRetina:true });
                  visor.popup = L.popup();
                  
                  //var opcionsBase= 'google';

                  //visor.map.addLayer(capa);
                  // -- Event en fer click    
                  visor.map.on('click', function(e) {        
                                    //placeCamera(e);
                                    recuperaAdreca(e.latlng);    
                                 });
                  afegeixBotons();          
                  //missatgePeuMapa( 'buscaPosicio' ); 
                  activaLocator();  
/*
                  L.control.custom({
                      position: 'topright',
                      content : '<button type="button" class="btn btn-default">'+
                                '    <i class="fa fa-crosshairs"></i>'+
                                '</button>'+
                                '<button type="button" class="btn btn-info">'+
                                '    <i class="fa fa-compass"></i>'+
                                '</button>'+
                                '<button type="button" class="btn btn-primary">'+
                                '    <i class="fa fa-spinner fa-pulse fa-fw"></i>'+
                                '</button>'+
                                '<button type="button" class="btn btn-danger">'+
                                '    <i class="fa fa-times"></i>'+
                                '</button>'+
                                '<button type="button" class="btn btn-success">'+
                                '    <i class="fa fa-check"></i>'+
                                '</button>'+
                                '<button type="button" class="btn btn-warning">'+
                                '    <i class="fa fa-exclamation-triangle"></i>'+
                                '</button>',
                      classes : 'btn-group-vertical btn-group-sm',
                      style   :
                      {
                          margin: '10px',
                          padding: '0px 0 0 0',
                          cursor: 'pointer',
                      },
                      datas   :
                      {
                          'foo': 'bar',
                      },
                      events:
                      {
                          click: function(data)
                          {
                              console.log('wrapper div element clicked');
                              console.log(data);
                          },
                          dblclick: function(data)
                          {
                              console.log('wrapper div element dblclicked');
                              console.log(data);
                          },
                          contextmenu: function(data)
                          {
                              console.log('wrapper div element contextmenu');
                              console.log(data);
                          },
                      }
                  })
                  .addTo(visor.map);
*/






























                  
               } 
			}
	
            // ---  FUNCIONS DE LOCATOR I EVENTS ASSOCIATS  
            function activaLocator(){
			      // Activa la localització del plugin de leaflet 
			
	            visor.locate = L.control.locate( {
                  position: 'topleft',  // set the location of the control
                  //layer: ; The layer that the user's location should be drawn on.
                  setView:'once',// Set the map view (zoom and pan) to the user's location as it updates. Options are false, 'once', 'always', 'untilPan', or 'untilPanOrZoom'
                  flyto:false, // 	Smooth pan and zoom to the location of the marker. Only works in Leaflet 1.0+.
                  keepCurrentZoomLevel: true, // Only pan when setting the view.
                  //clickBehavior: //What to do when the user clicks on the control. Has three options inView, inViewNotFollowing and outOfView. Possible values are stop and setView, or the name of a behaviour to inherit from.
                  //returnToPrevBounds:, // If set, save the map bounds just before centering to the user's location. When control is disabled, set the view back to the bounds that were saved.
                  //cacheLocation:, // Keep a cache of the location after the user deactivates the control. If set to false, the user has to wait until the locate API returns a new location before they see where they are again.
                  showCompass: true, //Show the compass bearing on top of the location marker
                  drawCircle: true,  // controls whether a circle is drawn that shows the uncertainty about the location
                  drawMarker: true,   //If set, the marker at the users' location is drawn.
                  //markerClass: 'LocationMarker',
                  //compassClass: 'CompassMarker',
                  //circleStyle:, //Accuracy circle style properties.
                  //markerStyle: {},
                  //compassStyle:{},
                  followCircleStyle: {},  // set difference for the style of the circle around the user's location while following
                  followMarkerStyle: {},
                  followCompassStyle:{},
                  icon: 'fa fa-map-marker',  // class for icon, fa-location-arrow or fa-map-marker
                  iconLoading: 'fa fa-spinner fa-spin',  // class for loading icon
                  iconElementTag:'span',
                  circlePadding: [0, 0], // padding around accuracy circle, value is passed to setBounds
                  //createButtonCallback:,
                  //getLocationBounds:,
                  onLocationError: function(err) {alert('Error en el posicionament');},  // define an error callback function                  
                  onLocationOutsideMapBounds:  function(context) { // called when outside map boundaries
                  //alert(context.options.strings.outsideMapBoundsMsg);
					   },    
                  showPopup: true, // display a popup when the user click on the inner marker
                  strings: {
                     title: "Troba la meva posició",  // title of the locate control
                     metersUnit: "meters", // string for metric units
                     feetUnit: "feet", // string for imperial units
                     popup: "Posició Actual",  // text to appear if user clicks on circle
                     outsideMapBoundsMsg: "Et trobes fora dels límits del mapa" // default message for onLocationOutsideMapBounds
                  },
                  locateOptions: {maximumAge: 3000, timeout: 5000, enableHighAccuracy: true }  // define location options e.g enableHighAccuracy: true or maxZoom: 10
                });                  
   			
				    //-- Incorpora el control al mapa
				    visor.locate.addTo(visor.map);
                visor.locate.start();                
				
			       //-- Funció quan troba la posició
				    visor.map.on('locationfound', posicioTrobada); // Quan troba la posició centra en el mapa
			}  			
         
            // -- Recupera la posició actual i la introdueix a les variables corresponents 
            // -- La posició actual es recupera del plugin LOCATE i es defineix la funcionalitat en les opcions del plugin
            function posicioTrobada(e) {
                //visor.alertaBuscantPosicio == 0 ? alert('BuscantPosició') : null;
                var latitude = e.latlng.lat;
                var longitude = e.latlng.lng;
                var estatAnterior = visor.posicioActual.trobat;
                visor.posicioActual =   { 'trobat' : 1,  
                                        'lat' : latitude,
                                        'lng' : longitude
                                        };                                        
                if (latitude == 0 ) {                   
                    visor.posicioActual = { 'trobat' : 0,
                                        'lat' : 41.24 ,
                                        'lng' : 2.1,
                                    };      
                }
            //    else {
            //    } 
            //    if ( visor.primeraUbicacio ==  1){
            //        missatgePeuMapa('');
            //        placeCamera(e);
            //        visor.primeraUbicacio = 0;
            //    }            
            }
            
            //-- Mostra la icona en el punt actual TODO: unificar funció anterior
			
        /*  function centraPosicio(punt,zoom){
                visor.map.setView(punt, zoom);
                if (visor.markerPosicioActualPresent == '0' ){
                    visor.markerPosicioActualPresent = '1';
                    var iconSizeX = 30;
                    var iconSizeY = 45;             
                    var iconMap = L.icon({
                        iconUrl: 'images/mypos.png' ,
                        shadowUrl: 'images/marker-shadow.png',
                        iconSize:     [iconSizeX, iconSizeY], // size of the icon
                        shadowSize:   [32, 32], // size of the shadow
                        iconAnchor:   [15, 45], // point of the icon which will correspond to marker's location
                        shadowAnchor: [10, 30],  // the same for the shadow
                        popupAnchor:  [0, -45 ] // point from which the popup should open relative to the iconAnchor
                    });       
                            
                    //L.marker().addTo(visor.map)
                    visor.markerPosicioActual = L.marker(e.latlng,{icon:iconMap})
                        .addTo(visor.map)
                        .bindPopup(
                            "<h2 style='font-family:Arial;font-size:1.5em;height:20px'>" 
                            + ' La teva posició'  
                            +  " <img width='30' src='images/troba.png' style='float:left;margin-right:2em'/ >" 
                            + "</h2>" 
                            + ' Posició actual aproximada'                  
                            );
                }
            }
         */
         
        /*   No es crida mai - Revisar
                        function mostraPosicioActual(){            
                            if (visor.posicioActual.trobat == 1) { 
                               centraPosicio(visor.posicioActual,17);
                            }
                            else{
                                //activaGeoposicionament();
                            }
                        }     
            */
            
            // Recupera el text de l'adreça propera segons OpenStreetMap            
            function recuperaAdreca(punt){ 
                $.getJSON("http://nominatim.openstreetmap.org/reverse?json_callback=?", 
                    { format: "json", lat: punt.lat, lon: punt.lng, zoom: 18, addressdetails: 1 },
                    function(data) { 
                        visor.adrecaOSM =  data.display_name.replace(/'/g, "\\'");
                });               
            }
           
            //-- Retorna els errors de posicionament -- No està vinculada amb LOCATE
            function onLocationError(e) {
                alert(e.message);
            }
            
        //-- ENVIAMENT DE LA FOTOGRAFIA I ACTUALITZACIÓ DE LA BASE DE DADES
        /*  
            function uploadFromGallery() {
                // Retrieve image file location from specified source
                if (visor.posicioCamera.lng == null) {				
				    alert('Selecciona un punt sobre el mapa per ubicar la foto');
				}	
				else 
				{
					navigator.camera.getPicture(    uploadPhoto,
													function(message) { alert("Problemes amb l'enviament"); },
													{   quality: 50, 
														targetWidth: 1024,
														targetHeight: 1024,
														destinationType: navigator.camera.DestinationType.FILE_URI,
														sourceType: navigator.camera.PictureSourceType.CAMERA,
														mediaType: navigator.camera.MediaType.ALLMEDIA
													}
												);
				  }							
            }
			
            function uploadPhoto(imageURI) {
                var options = new FileUploadOptions();
                //var options = {};
				    options.fileKey="file";
                options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);//+'.png';
                options.mimeType="image/jpeg";
				    options.headers = { Connection: "close" };
                var params = {};
                params.codi= 'Joan';
				    params.projecte = 'depana';
                params.usuari_codi = 'Gomis';
				    params.adreca = visor.adrecaOSM;
                params.descripcio = 'Simulació de descripcio';
                params.imatge = options.fileName;//file.name;
                params.den_x = parseFloat(visor.posicioCamera.lng);
                params.den_y = parseFloat(visor.posicioCamera.lat);
                params.usu_x = parseFloat(visor.posicioCamera.lng);
                params.usu_y = parseFloat(visor.posicioCamera.lat);                
                params.correu = "jbertranr@gmail.com";
				    params.risc = "alt";
				    options.params = params;
				    visor.params = params;
                var ft = new FileTransfer();
                ft.upload(imageURI, encodeURI("http://issolutions.esy.es/ma/www/php/upload.php"), ftWin, ftFail, options,true);				
            } 

            function ftWin(r) {
                console.log("Code = " + r.responseCode);
                console.log("Response = " + r.response);
                console.log("Sent = " + r.bytesSent);
				$.ajax({
					url: "http://issolutions.esy.es/ma/www/php/insert.php", 
					type: "POST",
					data: visor.params,

					success: function(){           						
						recuperaDarrerAvis();
						//setTimeout(function(){ $( "#editaDesc" ).trigger( "click" );missatgePeuMapa( 'mostraFoto', visor.data.length - 1 );}, 500);//creaImatgePujada(visor.params);
					},
					error: function(xhr, textStatus, errorThrown){
						alert("Error detectat. Puja-la de nou." + xhr.responseText 
							+ "\nstatus: " + textStatus 
							+ "\nerror: " + errorThrown);
					}                                       
				});             				
            }
			
            function ftFail(error) {
                alert("La imatge no s'ha pujat. Intenta-ho de nou");
                //console.log("upload error source " + error.source);
                //console.log("upload error target " + error.target);
            }       
         */ 
        
        // -- Funcions de geolocalització fent ús del PLUGIN de phonegap. En un pricii no s'utilitzen
		  /*

         function geoposiciona2(){
            var options = {
           enableHighAccuracy: true,
           timeout: 5000,
           maximumAge: 0
         };

         
        
         
         function success(pos) {
           var crd = pos.coords;
           console.log('Your current position is:');
           console.log(`Latitude : ${crd.latitude}`);
           console.log(`Longitude: ${crd.longitude}`);
           console.log(`More or less ${crd.accuracy} meters.`);
         }

         function error(err) {
           console.warn(`ERROR(${err.code}): ${err.message}`);
         }
         navigator.geolocation.getCurrentPosition(success, error, options); 
                 
      }*/ 
      
// --  A FUNCIONS SENSE ÚS
 /*
             function missatgePeuMapa( contingut, foto ){
			
                var txtPeu = '';
				
                switch ( contingut ) {
                    case 'fesFoto':
                        txtPeu =    ' <div onclick="uploadFromGallery();" style="width: 40%; margin-left: 30%; border-radius: 10px; color: rgb(255, 255, 255); text-shadow: 0px 0px rgb(0, 0, 0); background-color: #359; padding: 0.3em 0em 0.5em; height: 1em; margin-bottom: 0.2em; margin-top: 0.2em;">'
                                   +    '    Foto  <i class="fa fa-camera "></i>'
                                   +    ' </div>';
                        break;
                    				
                    
                    case 'buscaPosicio':
                        txtPeu =    ' <div style="width: 100%; margin-left: 5%; color: rgb(115, 115, 115); text-shadow: 0px 0px rgb(0, 0, 0); background-color: rgb(255, 255, 255); padding: 0.5em 0em 0.5em; height: 1.3em; margin-bottom: 0.2em; margin-top: 0.2em;">'
                                   +    '    Buscant localització ... <i class="fa fa-spin fa-spinner"/>'
                                   +    ' </div>';
                        break;

                    case 'mostraFoto':
                        if ( foto == visor.data.length ) { foto = visor.data.length - 1 }
                        if ( foto < 0 ) { foto = 0 }
						// if ( foto < 9 && foto > 0 ) { 
                            var punt = visor.data[foto];
							setTimeout(function(){visor.map.panTo([punt.den_y, punt.den_x]);},300);
                            var seguentFoto = foto + 1;
                            var anteriorFoto = foto - 1;
							if ( punt.descripcio.length < 1 ){
								punt.descripcio = 'Introduïu descripció';
							}
							visor.codiAvisVigent = punt.codi;
							txtPeu =      '   <div style="z-index:0;border-top: 2px solid #b9b900;width:100%;height:215px;overflow:hidden"> '                                 
                                        + '     <div style="display: block; text-align: center; font-size: 1em; border-radius: 0px; bottom: 0px; left: 0px; width: 100%; opacity: 1; color: rgb(122, 122, 122); height: 0.3em; background-color: rgb(255, 255, 255);"></div>'
                                        + '     <div style="overflow:hidden;margin-top:1em;margin-left:1em;float:left;font-size:0.8em;height:86%;background-color:#ffffff;width:40%;text-align:left"> '
                                        + '         <div style="color: rgb(196, 70, 0);background-color:#ffffff;float:left;font-weight:bold;font-size:1.6em;height:1.3em;width:63%;text-align:left;margin-top:-0.2em">'
                                        + '            AV-'
                                        +              punt.codi
										+ '         </div>'
                                        + '         <div style="color: rgb(196, 70, 0);float:left;font-weight:bold;font-size:1.0em;height:auto;background-color:#ffffff;width:100%;text-align:left;margin-top:-0.6em">'
                                        +               punt.data_imatge
                                        + '         </div>'
                                        + '         <div style="max-height:20%;overflow:hidden;clear: both; height: auto; background-color: rgb(255, 255, 255); width: 100%; text-align: left; margin-top: 3em; font-size: 0.7em;">'
                                        +               punt.adreca
                                        + '         </div>'
                                        + '         <div style="line-height:1em; clear: both;background-color: rgb(255, 255, 255); width: 100%; text-align: left; margin-top: 0.6em; font-size: 1em;height: 5.8em;overflow: hidden;">'
										+ '             <a  href="#imatgePujada" class="" data-transition="pop">'
                                        + '                <div id="editaDesc" class="botoDescripcioActiu">'
                                        +                     punt.descripcio
										+ '                </div>'
										+ '             </a>'                                        
										+ '         </div>   '
                                        + '         <div style="background-color:#ffffff;float:right;font-weight:bold;font-size:1.8em;height:1.3em;width:100%;text-align:left;margin-top:-0.2em">'
                                        + ' 	        <div style="width:40%;float:left">'
										+ ' 	           <i class="fa fa-arrow-left" onclick="missatgePeuMapa( \'mostraFoto\','
                                        +                     anteriorFoto 
                                        + '                );"/>'
								        + ' 	        </div >'
                                        + ' 	        <div style="width:40%;float:right">'
                                        + ' 	    	   <i style="float:left" class="fa fa-arrow-right" onclick="missatgePeuMapa( \'mostraFoto\','
                                        +                 	  seguentFoto 
                                        + '                );"/>'
								        + ' 	        </div >'
										+ '          </div>'                                        
										+ '     </div>   '                               
                                        + '     <div style="float:right;height:95%;overflow:hidden;width: 56%;background-color:#ffffff"> '
                                        + '         <img style="float:right;margin-right:1em;margin-top:0.5em; display:block;max-width:73%;max-height:90%;width:auto;height:auto;" src="http://issolutions.esy.es/ma/www/php/image/'
                                        +               punt.imatge 
                                        + '         " />'
                                        + '     </div>   '
                                        + ' </div> ';
                        //        }       
                        break;
                    
                    default:
                        missatgePeuMapa( 'fesFoto' );
                        break;                                
                }

                $('#peuMapa').html( txtPeu );
                
				$('#peuMapa')
					.show();
					
				
                ajustaFinestres(); 
               
            }
 
			//-- Ajax per recuperar punts 
            function recuperaElements(codigo) {
                visor.map.removeLayer(visor.totMarker);
                var params = {};
                params.codi = codigo;
				//codi = 1240;
					var llistat = ' ';
							llistat += ''
								+ '<div class="boto_4">'
								+ 	'<a style="color:#fff" '
							//	+ 	'   href="#llistaAvisos"'
								+ 	'   onclick=" recuperaElements();">'
								+     '		Darrer'
								+	 '</a>'
								+ '</div>'
								+ '<div class="boto_4">'
								+ 	'<a style="color:#fff" '			
							//	+ '	   href="#llistaAvisos"'
								+ '	   onclick=" visor.darrerAvisLlista = Number(visor.darrerAvisLlista) + 20 ;recuperaElements(visor.darrerAvisLlista);">'
								+ '	   Posteriors'
								+ '	</a>'
								+ '</div>'
								+ '<div class="boto_4">'
				                + 	'<a style="color:#fff" '			
								+ '	   onclick=" recuperaElements(visor.darrerAvisLlista);">'
								+ '	   Anteriors'
								+ '	</a>'

								+ '</div>'
								+ '<div class="boto_4">'
								+ 	'<a style="color:#fff" '			
								+ '	   href="#pageMap">'
								+ '	   Sortir'
								+ '	</a>'
								+ '</div>'
								+ 	'<div style="height:1em; width:100%"></div>';				
				
            
            
            $.ajax({
                    data:params,
				        type: "POST",
                    url: "http://issolutions.esy.es/ma/www/php/select.php",
                   // contentType: "application/json; charset=ISO-8859-1",
                    dataType: "json",
                    success: function( data ) {                   
                        if (data  != 'test'){
							visor.data = data;
							visor.totMarker = new L.FeatureGroup();
							var iconSizeX = 30;
							var iconSizeY = 45;             
							var iconMap = L.icon({
								iconUrl: 'images/marker-icon-red.png' ,
								shadowUrl: 'images/marker-shadow.png',
								iconSize:     [iconSizeX, iconSizeY], // size of the icon
								shadowSize:   [32, 32],  // size of the shadow
								iconAnchor:   [15, 45],  // point of the icon which will correspond to marker's location
								shadowAnchor: [ 10, 30], // the same for the shadow
								popupAnchor:  [ 0,-45]   // point from which the popup should open relative to the iconAnchor
							});       
						   // var llistat = '<div data-demo-html="true"><ul data-role="listview"> ';
								
                        
							$.each(visor.data,function(i,punt){
								visor.darrerAvisLlista = punt.codi;
								var diaData = punt.data_imatge.split(' ')[0].split('-');
								var horaData = punt.data_imatge.split(' ')[1];
								
								llistat += '<div style="height:auto; width:100%;margin-top:1em;border-top:#444 1px dotted;overflow:hidden" >'
												+ '<div style="float:left;width:60%;height:auto;margin-top:1em;">'
												+ '   <div style="float:left;height:auto;width:100%">'
												+       '<span style="font-weight:bold;font-size:1.0em;color:#359">' +  punt.codi + ' </span> ' 
												+       '<span style="font-weight:bold;font-size:1.0em;color:#359"> - ' + diaData[2] + '/' + diaData[1] + '/'+diaData[0] + '</span>  ' + '<span style="font-size:0.8em"> (' + horaData + ')</(span>'
												+ '   </div>'
												+ '   <div style="float:left;height:auto;font-size:0.8em;color:#B57;">'
												+       '<b>' +  punt.correu + ' </b> ' 
												+ '   </div>'											
												+ '   <div style="float:left;height:auto;font-size:0.8em;color:#579;">'
												+       '<b>' +  punt.adreca + ' </b> ' 
												+ '   </div>'
												+ '   <div style="font-size:0.9em;float:left;height:auto;margin-top:1em;color:#888;font-size:0.9em;width:100%"">'
												+       '' +  punt.descripcio + '' 
												+ '   </div>'											
												+ '</div>' 
												+ '<div style="float:right;width:110px;height:auto;margin-top:1em;">'
												+ '   <div style="float:right"> <img  width=100  src="http://issolutions.esy.es/ma/www/php/image/' 
												+          punt.imatge 
												+          '?d='
												+          new Date().getTime() // TODO: Per refrescar cache (optimitzar-ho amb onerror)                                            
												+ '   " /> '
												+ '   </div>'
												+ '</div>'
												+ '</div> ';
												
							--  var marker = L.marker([punt.den_y, punt.den_x],{icon: iconMap})
							-- 		.bindPopup('  <div>'
							-- 					+     punt.data_imatge
							-- 					+ '</div>'
							--					+ '<div><b>'
							--					+ punt.adreca
							--					+ '</b></div>'
							--					+    '<img width=125 onerror="alert(\'Pujant la imatge ...\')" src="http://issolutions.esy.es/ma/www/php/image/' 
							--					+       punt.imatge 
							--					+       '?d='
							--					+       new Date().getTime() // TODO: Per refrescar cache (optimitzar-ho amb onerror)                                            
							--					+ '" />');
							--	visor.totMarker.addLayer(marker);
							--	visor.map.addLayer(visor.totMarker);
								
							});
						}
						//llistat += '</ul>' ;

						
						
						
						$('#contLlista').html('').html(llistat);
						
                    },
					error:function(){alert('eeeesss');}
                });
            }   
 	   //-- Ajax per recuperar punts 
            function recuperaDarrerAvis() {
                //visor.map.removeLayer(visor.totMarker);
                //alert('dsdsd');
				$.mobile.changePage( "#revisaImatge");
				$.ajax({
                    type: "POST",
                    url: "http://issolutions.esy.es/ma/www/php/select_darrer.php",
                    //contentType: "application/json; charset=ISO-8859-1",
                    dataType: "json",
                    success: function( data ) {   
						visor.data = data;
						$.each(visor.data,function(i,punt){
							if (i == 0){
								$('#textarea-1').val(visor.data[0].adreca);
								$('#imatge-1').attr('src','http://issolutions.esy.es/ma/www/php/image/' + visor.data[0].imatge ); 
								//alert(punt.codi);
								visor.params.codi = visor.data[0].codi;
							}
					    });
                    },
					error:function(){alert('sss');}
                });
            }  
  			

            
            function creaImatgePujada(params) {
            
                $('#divImatgePujada').prepend( '     <div class="divContImatge" style="width=100%;height:auto"> '
                                            + '         <div class="divContImatgeTitol" style="font-size:14px;height:30px;"> '
                                            + '             Dades de la Imatge Pujada '
                                            + '         </div> '
                                            + '         <div class="divContImatgeDades" style="font-size:12px;height:auto;margin-left:20px;margin-bottom:10px;"> '
                                            + '             <p><b> Nom: </b>' 
                                            +                   params.adreca
                                            + '             </p> '      
                                            + '         </div> '
                                            + '         <div class="divContImatgeDades" style="font-size:12px;height:auto;margin-left:20px;margin-bottom:10px;"> '
                                            + '             <p><b> Adreça: </b>' 
                                            +                   params.codi
                                            + '             </p> '      
                                            + '         </div> '
                                            + '         <div class="divContImatgeDades" style="font-size:12px;height:auto;margin-left:20px;margin-bottom:10px;"> '
                                            + '             <p><b> Codi Usuari: </b>' 
                                            +                   params.usuari_codi
                                            + '             </p> '      
                                            + '         </div> '                                            
                                            + '         <div class="divContImatgeCoords" style="font-size:12px;height:20px;margin-left:20px;margin-bottom:10px;"> '
                                            + '             <p><b> Longitud: </b>' 
                                            +               params.den_x
                                            + '             <b> Latitud: </b>'                                      
                                            +               params.den_y
                                            + '             </p> '      
                                            + '         </div> '
                                            + '         <div class="divImatge" style="width:100%;height:auto;margin-left:20px; "> '
                                            + '             <img width=300 src="http://issolutions.esy.es/ma/www/php/image/'                                   
                                            +                   params.imatge
                                            + '             "></img>'
                                            + '          </div> '
                                            + '     </div>');
                                            
                // $.mobile.changePage($('#imatgePujada'),'pop'); Per ara bloquejat - Nomostra les dades de la imatge pujada per deixar temps a que pugi a l'aplicació
            }
            
            
            // Creació del llistat de punts 
            function creaRelacioPunts(){
                $.each(visor.data,function(i,punt){
                    //var puntMapa = $('<div/>')
                    //    .addClass('llistaElementMapa')
                    //    .html('<div>'
                    //            + 'punt'   
                    //            +'<img width=70 src="' 
                    //            + punt.vc_imatge 
                    //            + '"/>'
                    //            + '</div>') 
                    //    .appendTo($('#relacioPuntsMapa'));      
                                       
                    $('#relacioPuntsMapa').append(    '  <ol data-role="listview"> '
                                                    + '     <li>'
                                                    + '         <a href="#"> List Item '
                                                    +               i
                                                    + '             <img width=70 src="http://issolutions.esy.es/ma/www/php/image/' 
                                                    +                   punt.imatge 
 //                                                   + '#'
 //                                                   + new Date().getTime() // TODO: Per refrescar cache (optimitzar-ho amb on error)
                                                    + '             " />'                                                
                                                    + '         </a>'
                                                    + '     </li>'
                                                    + '  </ol>');
                });
                $('#relacioPuntsMapa').height($(window).height() - 250);    
            }
            
            // Situar la icona de la càmera
            function placeCamera(e){
                visor.map.removeLayer(visor.markerCamera);
                var iconSizeX = 030;
                var iconSizeY = 030;             
                var iconMap = L.icon({
                    iconUrl: 'images/camera-icon.png',
                    iconSize:     [iconSizeX, iconSizeY], 	// size of the icon
                    shadowSize:   [32, 32], 				// size of the shadow
                    iconAnchor:   [15, 15], 				// point of the icon which will correspond to marker's location
                    shadowAnchor: [10, 30],  				// the same for the shadow
                    popupAnchor:  [-0 , -16 ] 				// point from which the popup should open relative to the iconAnchor
                });       

                visor.markerCamera = L.marker(e.latlng,{icon:iconMap})
                    .addTo(visor.map)
                    .bindPopup(
                        "<h2 style='font-family:Arial;font-size:1.2em;height:auto;width:200px'>" 
                        +  " <img width='30' src='images/camera-icon.png' style='float:left;margin-right:2em'/ >"   
                        + ' Indret on es farà la fotografia'  
                        + "</h2>" 
                        + ''                    
                        )
                    .on('click', uploadFromGallery);
                visor.posicioCamera = e.latlng;
                missatgePeuMapa('<a class="btn btn-danger" onclick="uploadfromGallery()"> <img class="" src="images/camera-icon.png" style=" width: 30px; height: 30px;" />Captura </a>' );
                //missatgePeuMapa( 'fesFoto' )                
                ajustaFinestres();    
            } 
 
 
 
       */


            

   </script>
	<!--script async defer src="https://apis.google.com/js/api.js"	onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"-->
	</script>
    
    </head>
    
    <body style="font-family:arial">
    
        
        <!--------------------------------  Pàgina Mapa ------------------------------------------->     
        <div data-role="page" id="pageMap" > 
            <!------------------ Header ----------recuperaElements()----->    
			<div id="header" class="ui-nodisc-icon ui-alt-icon" style="display:flex;flex-direction:row;justify-content:space-between;height:2.3em;background-color: #359; color: rgb(250, 250, 250);font-size: 1.1em; font-weight: lighter; text-shadow: 0px 0px; z-index: 1; " role="banner" data-role="header" class="ui-header ui-bar-inherit">
				<!--div id="troba4" style="float: left; height:24px ; font-size: 1.5em; width: 16px;" onclick="recuperaDarrerAvis();">			
				</div-->
            <!--button class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-bars ui-btn-icon-notext">bars</button-->
				<!--a href="#" class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all">No text</a-->
            <div class="boto" style="order:0;margin:0.5em 0.7em;">
               <div onclick="$('#panellTaula').panel('close');$('#panellMenu').panel('open');" > 
                  <i class="fa fa-bars"></i>
               </div>   
            </div>   
            
            
            
            <div style="order:1;font-family: Verdana; color: rgb(220, 70, 0);">
					<!--div onclick="recuperaDarrerAvis();$(':mobile-pagecontainer').pagecontainer('change', '#revisaImatge');" style="float: left; font-weight:bolder; text-align: center; font-family: Verdana; color: rgb(255, 255, 255); width: 100%; height: 1.1em; margin-top: 0.25em;"--> 
					<!--div onclick="$(':mobile-pagecontainer').pagecontainer('change', '#paraulaPas');" -->
               <!--div onclick="window.open('https://aplicacions.mataro.org:444/apex/f?p=261:5','_self'); "--> 
               <div onclick="mostraJSON(); " 			      
					     style="height:auto;float: left; font-weight:bolder; text-align: center; font-family: Verdana; color: rgb(255, 255, 255); width: 100%; height: 1.1em; margin-top: 0.25em;"> 						
							Informació via pública                     
				   </div>
					<div style="clear: both; text-align: center; font-family: Verdana; color: rgb(255, 255, 255); font-size: 0.6em; width: 100%; height: 15px; margin-top: -1px;"> Comunicacions mòbils </div>
				</div>
            <div class="boto" style="order:2;margin:0.5em 0.7em;" onclick="navigator.app.exitApp();">
               <i class="fa fa-close"></i>
            </div>              
         </div>



        <!------------------ Content --------------->
           <div data-role="content">
              <div id="map-wrap" style="display:flex;flex-direction:column;flex-wrap:wrap;height:100%">


                 <div style="min-width:20em;flex-grow:1;order:2;height:100%"> 
                    <div id="contMapa" > <!--style="clear:both;overflow:hidden;border-top:1px solid rgb(211,211,211);padding-top:14px;padding-left:0px;"-->
                        <div class="caixaControl" ></div>
                        <div class="caixaControlPeu" > 
                           <div id="troba4" onclick="uploadFromGallery()" class="controlMapa controlMapa-separat" style="display:none;border-radius: 1em;width: 2em;height: 2em;background-color: #c00;">
                                 <i class="fa fa-camera" aria-hidden="true" style="padding-top:0.5em"></i>
                            </div>
                        </div>
                        <div class="caixaControlInferior">
                        </div>
                        <div id="map" style="height:100%;margin-top:-30px;margin-left:0px"></div>           
                   </div>
                </div>     
              </div>
            </div>
            
            <!------------------ Footer --------------->

            <!--div data-role="footer"> 
                <div id="peuMapa" style="height:auto; display:block;position: fixed; text-align: center; font-size: 1.1em; background-color: rgb(255, 255, 255); border-radius: 0px; bottom: 0px; left: 0px; width: 100%; opacity: 1; color: rgb(122, 122, 122);">
                </div>
            </div-->
            <div data-role="panel" class="ui-panel ui-panel-position-left ui-panel-display-reveal ui-panel-closed ui-body-a ui-panel-animate" data-position="left" data-display="push" data-theme="a" id="panellMenu">
               <div class="ui-nodisc-icon ui-alt-icon" style="display:flex;flex-direction:row;justify-content:space-between;height:auto;color:#444;font-size: 1em; font-weight: 100; ">            
                  <div style="order:1;flex-grow:2;height:auto;text-align: center; font-family: Verdana;margin-bottom:1em"> 						
                        Cercador                     
                  </div>                  
                  <div class="boto" style="order:2;" onclick="$('#panellMenu').panel('close');"> 
                       <i class="fa fa-arrow-left"></i>
                  </div>
                </div>
               
                <form class="ui-filterable">
                   <input id="autocomplete-input" data-type="search" placeholder="Equipament, carrer, cadastre, ...">
                </form>
                
                <div id="autocomp" style="clear:both;width:100%;overflow:auto;margin-bottom:0.5em">  
                   <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="false" style="position.relative;"></ul>
                </div>   
              </div>

            <div data-role="panel" class="ui-panel ui-panel-position-left ui-panel-display-reveal ui-panel-closed ui-body-a ui-panel-animate" data-position="left" data-display="push" data-theme="a" id="panellTaula">
               <div class="ui-nodisc-icon ui-alt-icon" style="display:flex;flex-direction:row;justify-content:space-between;height:auto;color:#444;font-size: 1em; font-weight: 100; ">            
                  <div style="order:1;flex-grow:2;height:auto;text-align: center; font-family: Verdana;margin-bottom:1em"> 						
                        Taula de dades                     
                  </div>                  
                  <div class="boto" style="order:2;" onclick="$('#panellTaula').panel('close');"> 
                     <i class="fa fa-arrow-left"></i>
                  </div>
               </div>
               
                <form class="ui-filterable">
                   <input id="taulaBase-input" data-type="search" placeholder="Adreca ... ">
                </form>               
               
               
               <div id="taulaBaseWrap" style="clear:both;width:100%;overflow:auto;margin-bottom:0.5em">  
                  <ul id="taulaBase" data-role="listview" data-inset="true" data-filter="false" style="position.relative;"></ul>
               </div>   
            </div>  


              

         </div>
            
            
            
            
        


        <!--------------------------------  Càrrega dades ---------------------------------> 
		
        <!--------------------------------  Pas 1/4       ---------------------------------> 
		<div data-role="page" 
		     data-dialog="true" 
			 data-close-btn="none" 
			 id="revisaImatge"> 
            <div data-role="header"  role="banner" id = "headerDetail" style="z-index: 1; box-shadow:0px 2px 6px #444444;">         
                 <h1>Imatge pujada</h1> 
            </div>           

            <div data-role="content" id="contImatgePujada"> 
                <form id="frmImatgePujada" data-ajax="false" >
					<label for="imatge-1">Revisa la imatge adreçada
				</label>
					<img style="width:80%;margin:0 10%" id="imatge-1" src=""/> 				
					<a class="ui-btn ui-corner-all ui-icon-delete " 
					   href="#pageMap">
					    Cancelar
				    </a>					
					<a onclick="visor.params.descripcio=$('#textarea-1').val();"   
					   class="ui-btn ui-btn-b ui-corner-all ui-icon-delete " 
					   href="#avisMapa2">
						Següent
				    </a>
			    </form>            
            </div>
			
            <div data-role="footer">
                <h1>Pas 1/4</h1>
            </div>          
			
        </div>		
	



		
        <!--------------------------------  Pas 2/4       ---------------------------------> 
		<div data-role="page" 
		     data-dialog="true" 
			 data-close-btn="none" 
		     id="avisMapa2"> 
			 
            <div data-role="header"  role="banner" id = "headerDetail" style="z-index: 1; box-shadow:0px 2px 6px #444444;">         
                 <h1>Ubicació Avís</h1> 
            </div>           

            <div data-role="content" id="contImatgePujada"> 
                <form id="frmImatgePujada" data-ajax="false" >
					<label for="textarea-1">Adreça automàtica - Afegiu observacions per identificar</label>
					<textarea name="textarea-1" id="textarea-1"></textarea>
					<a class="ui-btn ui-btn-a ui-corner-all ui-icon-delete " 
					   href="#pageMap">
						Cancelar
				    </a>			
					
					<a onclick="visor.params.adreca=$('#textarea-1').val();"
					   class="ui-btn ui-btn-b ui-corner-all ui-icon-delete " 
					   href="#imatgePujada2">
						Següent
				    </a>
			    </form>            
            </div>

			
            <div data-role="footer">
                <h1>Pas 2/4</h1>
            </div>          
			
        </div>		
		

        <!--------------------------------  Pas 3/4       ---------------------------------> 
		
        <div data-role="page" 
		     data-dialog="true" 
			 data-close-btn="none" 
			 id="imatgePujada2"> 
            <div data-role="header"  role="banner" id ="headerImatgePujada" style="z-index: 1; box-shadow:0px 2px 6px #444444;">                
                 <h1>Identificació del risc </h1>         
            </div>
 
            <div data-role="content" id="contImatgePujada"> 
				<form>
					<!--fieldset data-role="controlgroup">
						<legend>Trieu una opció:</legend>
						<input name="checkbox-v-2a" id="checkbox-v-2a" type="checkbox">
						<label for="checkbox-v-2a">Normal</label>
						<input name="checkbox-v-2b" id="checkbox-v-2b" type="checkbox">
						<label for="checkbox-v-2b">Urgent</label>
						<input name="checkbox-v-2c" id="checkbox-v-2c" type="checkbox">
						<label for="checkbox-v-2c">Molt Urgent</label>
					</fieldset-->
				    <label for="textarea-1b">Descripció</label>
					<textarea name="textarea-1b" id="textarea-1b"></textarea>

					<a class="ui-btn ui-btn-a ui-corner-all ui-icon-delete " 
					   href="#pageMap">
						Cancelar
				    </a>								
					<a 				  
					    onclick="visor.params.descripcio=$('#textarea-1b').val();"
					    href="#imatgePujada3" 
					    class="ui-btn ui-btn-b ui-corner-all ui-icon-delete " >
						Següent
				    </a>
					 <!-- onclick="visor.params.risc = $('#checkbox-v-2a').val();"  -->
				</form>           
            </div>
			
            <div data-role="footer">
                <h1>Pas 3/4</h1>
            </div>
			
		</div>
		
        <!--------------------------------  Pas 4/4       --------------------------------->     
        <div data-role="page" 
		     data-dialog="true" 
			 data-close-btn="none" 
		     id="imatgePujada3"> 
            <div data-role="header"  role="banner" id ="headerImatgePujada2" style="z-index: 1; box-shadow:0px 2px 6px #444444;">                
                 <h1>Dades de contacte</h1>         
            </div>            

            <div data-role="content" id="contImatgePujada2"> 
                <form id="frmActDesc3" data-ajax="false" >
					<label for="correu">Correu electrònic de contacte per informar de seguiment</label>
					<textarea name="correu" id="correu"></textarea>
					<a class="ui-btn ui-btn-a ui-corner-all ui-icon-delete " 
					   href="#pageMap">
						Cancelar
				    </a>								

					<a onclick="visor.params.correu = $('#correu').val(); actualitzaDescripcio()"  
					   href="#pageMap"
					   class="ui-btn ui-btn-b ui-corner-all ui-icon-delete " >
						Adreçar les noves dades 
				    </a>
			    </form>            
            </div>
			
            <div data-role="footer">
                <h1>Pas 4/4</h1>
            </div> 
         
        </div>
        <!--------------------------------  Mostra Llista ---------------------------------> 
		
        <!--------------------------------        ---------------------------------> 
		<div data-role="page" 
		     data-dialog="true" 
			 data-close-btn="none" 
			 id="llistaAvisos"> 
            <div data-role="header"  role="banner" id = "headerDetail" style="z-index: 1; box-shadow:0px 2px 6px #444444;">         
                 <h1>Avisos</h1> 
            </div>           

            <div data-role="content" style="font-size:0.8em" id="contLlista"> 
        
            </div>
	
	
            <div data-role="footer">
                <h1>Avisos</h1>
            </div>          
			
        </div>	
        
        <!--------------------------------  Panell ---------------------------------> 

         <!--div id="leftpanel1" class="ui-panel ui-panel-position-left ui-panel-display-reveal ui-panel-closed ui-body-a ui-panel-animate" data-theme="a" data-display="reveal" data-position="left" data-role="panel" -->
         

         
         <!-- page -->



        

       <!--------------------------------  Mostra Llista ---------------------------------> 
		
        <!--------------------------------        ---------------------------------> 
		<div data-role="page" 
		     data-dialog="true" 
			 id="paraulaPas"> 
            <div data-role="header"  role="banner" id = "headerDetail" style="z-index: 1; box-shadow:0px 2px 6px #444444;">         
                 <h1>Paraula de pas</h1> 
            </div>           

            <div data-role="content" style="font-size:0.8em" id="ppasCont"> 
               <form id="frmPpas" data-ajax="false" >
					<label for="ppas">Paraula de pas</label>
					<textarea name="ppas" id="ppas"></textarea>
					<a class="boto_4" style="margin-left:40%;color:#fff" onclick="var ppas2 = $('#ppas').val();  if (ppas2 == 'depana1234'){recuperaElements();$(':mobile-pagecontainer').pagecontainer('change', '#llistaAvisos');   }">
						Llistat
				    </a>
			    </form>            

            </div>
	
	
            <div data-role="footer">
                <h1>Avisos</h1>
            </div>          
			
        </div>		
	
		
        <!--  Pàgina Imatge Pujada -->      
        <div data-role="page" data-dialog="false" id="imatgePujada"> 
            <div data-role="header"  role="banner" id ="headerImatgePujada" style="z-index: 1; box-shadow:0px 2px 6px #444444;">                
                 <h1>Identifica </h1>         
            </div>
 
            <div data-role="content" id="contImatgePujada"> 
                <form id="frmActDesc" data-ajax="false" >
					<label for="textarea-1">Descripció </label>
					<textarea name="textarea-1" id="textarea-1"></textarea>
					<!--a onclick="actualitzaDescripcio()" data-rel="back" data-theme="b" class="ui-btn ui-corner-all ui-icon-delete " href="#"-->
					<a onclick="visor.params.descripcio=$('#textarea-1').val();"  data-theme="b" class="ui-btn ui-corner-all ui-icon-delete " href="#imatgePujada2">
						Següent
				    </a>
			    </form>            
            </div>
			
            <div data-role="footer">
                <h1>Dades enregistrades</h1>
            </div>
			
		</div>
		
		        <div data-role="page" data-dialog="false" id="llistaElements"> 
            <div data-role="header"  role="banner" id = "headerDetail" style="z-index: 1; box-shadow:0px 2px 6px #444444;">         
                 <h1>Elements en el mapa</h1> 
            </div>           

            <div data-role="content" id="contMapDetail"> 
                <div id="relacioPuntsMapa" style="height:300px"></div>              
            </div>
			
            <div data-role="footer">
                <h1>Tots els elements trobats</h1>
            </div>          
			
        </div>
		
    </body>
</html>   


